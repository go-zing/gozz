<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>介绍 | Gozz</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="基于编译时的 Golang 注解分析及代码生成器，提供开箱即用的架构强化和插件化扩展能力，协助落地企业级最佳实践、提速业务开发。">
    
    <link rel="preload" href="/gozz/assets/css/0.styles.300559b5.css" as="style"><link rel="preload" href="/gozz/assets/js/app.182b309c.js" as="script"><link rel="preload" href="/gozz/assets/js/2.56b32e98.js" as="script"><link rel="preload" href="/gozz/assets/js/1.43cfabac.js" as="script"><link rel="preload" href="/gozz/assets/js/24.eaeafa36.js" as="script"><link rel="prefetch" href="/gozz/assets/js/10.18312648.js"><link rel="prefetch" href="/gozz/assets/js/11.a751f345.js"><link rel="prefetch" href="/gozz/assets/js/12.da302e69.js"><link rel="prefetch" href="/gozz/assets/js/13.5b11254d.js"><link rel="prefetch" href="/gozz/assets/js/14.cb88526c.js"><link rel="prefetch" href="/gozz/assets/js/15.8f39dbb1.js"><link rel="prefetch" href="/gozz/assets/js/16.f4bf23f4.js"><link rel="prefetch" href="/gozz/assets/js/17.3ceb826c.js"><link rel="prefetch" href="/gozz/assets/js/18.b434740f.js"><link rel="prefetch" href="/gozz/assets/js/19.b0466d00.js"><link rel="prefetch" href="/gozz/assets/js/20.404aed17.js"><link rel="prefetch" href="/gozz/assets/js/21.491ae04b.js"><link rel="prefetch" href="/gozz/assets/js/22.6efc7ed2.js"><link rel="prefetch" href="/gozz/assets/js/23.9ca48153.js"><link rel="prefetch" href="/gozz/assets/js/3.e04a1178.js"><link rel="prefetch" href="/gozz/assets/js/4.6aaf9938.js"><link rel="prefetch" href="/gozz/assets/js/5.868c619a.js"><link rel="prefetch" href="/gozz/assets/js/6.11ff47cc.js"><link rel="prefetch" href="/gozz/assets/js/7.3acf3203.js"><link rel="prefetch" href="/gozz/assets/js/vendors~docsearch.b7a3ab4f.js">
    <link rel="stylesheet" href="/gozz/assets/css/0.styles.300559b5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/gozz/zh/" class="home-link router-link-active"><!----> <span class="site-name">Gozz</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/gozz/zh/guide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="选择语言" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/gozz/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/gozz/zh/guide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/go-zing/gozz" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/gozz/zh/guide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="选择语言" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/gozz/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/gozz/zh/guide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/go-zing/gozz" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>介绍</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/gozz/zh/guide/#理念" class="sidebar-link">理念</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/gozz/zh/guide/#谁适合使用" class="sidebar-link">谁适合使用？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/gozz/zh/guide/#个人" class="sidebar-link">个人</a></li><li class="sidebar-sub-header"><a href="/gozz/zh/guide/#团队" class="sidebar-link">团队</a></li><li class="sidebar-sub-header"><a href="/gozz/zh/guide/#微服务-or-单体" class="sidebar-link">微服务 or 单体</a></li></ul></li><li><a href="/gozz/zh/guide/#前世今生" class="sidebar-link">前世今生</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/gozz/zh/guide/#对更合理架构的追求" class="sidebar-link">对更合理架构的追求</a></li><li class="sidebar-sub-header"><a href="/gozz/zh/guide/#非显式依赖全局实体或函数" class="sidebar-link">非显式依赖全局实体或函数</a></li><li class="sidebar-sub-header"><a href="/gozz/zh/guide/#显式依赖接口-依赖注入" class="sidebar-link">显式依赖接口 + 依赖注入</a></li><li class="sidebar-sub-header"><a href="/gozz/zh/guide/#接口设计和依赖注入工具化" class="sidebar-link">接口设计和依赖注入工具化</a></li><li class="sidebar-sub-header"><a href="/gozz/zh/guide/#切面化-api-controller" class="sidebar-link">切面化 API Controller</a></li></ul></li><li><a href="/gozz/zh/guide/#它是如何工作的" class="sidebar-link">它是如何工作的？</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h1> <p><code>Gozz</code> 由三部分组成：</p> <ol><li><p><code>Gozz-core</code> 是 <code>Gozz</code> 运行的内核，包含了对于 Golang 文件语法解析以及从解析后的 AST 中提取 <code>+zz:${plugin}</code> 风格注解
并解析为对应插件选项的工具，同时为各个插件提供包含 模版、生成、编辑、追加 Golang 文件的一系列封装库。</p></li> <li><p><code>Gozz</code> 是用户使用 <code>Gozz</code> 的客户终端，即 cli 工具运行的入口，包含了对用户命令的解析，插件的加载和实例化，以及对外部扩展的加载。</p></li> <li><p><code>Gozz</code> 中还提供了一系列强大的内置插件，囊括了作者在发起该项目时希望能够替自己解决以及将这些优秀设计快速落地到技术团队的一些核心功能需求，包括：</p> <ul><li>如何快速构建API和输出API、业务领域文档，并减低持续迭代的多分发校对成本</li> <li>如何通过优化系统依赖架构提升项目可迭代性，同时优化多人大型项目协作效率</li> <li>如何灵活切面化注入技术性功能，提升可观测性同时尽可能降低开发者的埋点工作量</li></ul></li></ol> <h2 id="理念"><a href="#理念" class="header-anchor">#</a> 理念</h2> <p>编程 就是将 <strong>重复、繁琐的事情</strong> ，将成熟的方案 通过程序化实现高效、低成本、规范化的解决</p> <p>而我们的设计和开发过程中本身有很多工作，本身也是 <strong>重复、繁琐的事情</strong></p> <p>在我们一遍又一遍地去浪费时间做这些 低效开发时 本身就违背了编程的初衷和思想</p> <p><code>Gozz</code> 希望 将成熟的技术方法论 和 优秀的系统架构方案 高效、低成本、规范化地 传播和落地</p> <p>并希望大家由此能</p> <blockquote><p>Less, But Better</p></blockquote> <p>而 <code>Gozz</code> 实现这点的理念就是</p> <blockquote><p>最好的代码，是不需要每个人都写的代码</p></blockquote> <h2 id="谁适合使用"><a href="#谁适合使用" class="header-anchor">#</a> 谁适合使用？</h2> <h3 id="个人"><a href="#个人" class="header-anchor">#</a> 个人</h3> <p><code>Gozz</code> 不会在 Feature 中强调对初阶 Gopher 的友好性，因为 <em><code>注释注解</code></em> 是非官方的特性，我们不希望引入额外认知成本 从而影响
Gopher 对 Golang 本身的学习曲线</p> <p>一方面 <code>Gozz</code> 部分插件的生成结果的使用 需要开发者对 Golang 类型和 <code>interface</code> 系统 甚至 <code>reflect</code> 有一定深入认知</p> <p>另一方面 对于 <code>Gozz 解决的到底是什么问题</code> 也需要对 系统架构 和 设计模式 有一定的认知前提</p> <p>如果你有使用 <code>JAVA Spring</code> 的经验，那么恭喜，你可以有一定的认知优势</p> <p><code>Gozz</code> 解决需求的思路学习了 <code>JAVA Spring</code> 一些重要设计思想，<strong>但绝不是拙劣地模仿</strong>。</p> <h3 id="团队"><a href="#团队" class="header-anchor">#</a> 团队</h3> <p>在 <code>人月神话</code> 中 提出了 <code>保有概念整体性</code> 的说法 这个系统设计理念也是笔者比较认同 即：</p> <blockquote><p>系统的核心架构设计 需要由极少数人专制控制</p></blockquote> <p>因此，使用 <code>Gozz</code> 的时候，团队需要由一个核心的架构师角色给出适合团队的 <code>Gozz</code> 配置 以及 维护生成模板和适配层</p> <p>在团队内 即使是不同的业务项目 在 <code>Gozz</code> 的使用上 都不应该产生过多分歧</p> <p>而其他成员 只需要遵循团队的规范 将运行 <code>Gozz</code> 的指令写到 项目 <code>Makefile</code> 或构建工具 在 代码变更 及 提交之前 去执行</p> <h5 id="实际上-笔者在以往工作团队中推广-gozz-的前世内部版本-也是以相同的模式进行"><a href="#实际上-笔者在以往工作团队中推广-gozz-的前世内部版本-也是以相同的模式进行" class="header-anchor">#</a> <em>实际上，笔者在以往工作团队中推广 <code>Gozz</code> 的前世内部版本 也是以相同的模式进行</em></h5> <p>但是 <code>Gozz</code> 鼓励所有团队角色去主动探索和学习 如何去优化业务和项目的架构设计 用更低的成本 办 更多更好的事</p> <p><code>Gozz</code> 也将会在项目示例中提供一些最佳实践 供开发者们参考</p> <h3 id="微服务-or-单体"><a href="#微服务-or-单体" class="header-anchor">#</a> 微服务 or 单体</h3> <p><code>Gozz</code> 并不针对微服务场景，相反，越大型的项目和协作团队，会越容易从 <code>Gozz</code> 中受益更多</p> <p>实际上 微服务 只代表 服务在企业业务依赖领域设计中 的 <code>Micro</code> 或 <code>Pluggable</code> ，从来不代表 项目代码架构层级和设计的简单</p> <p>因此 如果你希望团队的微服务项目代码质量能够得到一定的提升 也欢迎使用 <code>Gozz</code> 去组织团队的开发</p> <h2 id="前世今生"><a href="#前世今生" class="header-anchor">#</a> 前世今生</h2> <p><code>Gozz</code> 的诞生没有借鉴任何已有 Golang 工具 或是 对某某轮子的复刻，而是笔者多年来对 Golang 开发经验和沉淀总结的系统方法论具象化。</p> <h3 id="对更合理架构的追求"><a href="#对更合理架构的追求" class="header-anchor">#</a> 对更合理架构的追求</h3> <p>该工具的相关需求诞生于 2018 年附近，当时笔者在某集团内部系统技术团队，手上有一个数十万行级 OA 系统的重构工作。</p> <p>当时的代码大量充斥着一种写法，也是那个年代的 Golang 项目较为主流的一种写法：</p> <p>对于某个模块的初始化</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> pkg

<span class="token keyword">var</span> <span class="token punctuation">(</span>
	something     <span class="token operator">*</span>Something
	somethingInit sync<span class="token punctuation">.</span>Once
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">GetSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Something <span class="token punctuation">{</span>
	somethingInit<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token operator">...</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> something
<span class="token punctuation">}</span>
</code></pre></div><p>对于该模块的引用</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> pkg2

<span class="token keyword">func</span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	pkg<span class="token punctuation">.</span><span class="token function">GetSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DoXXX</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>而项目从 <code>API路由</code> / <code>路由服务绑定</code> / <code>领域服务</code> / <code>数据存储</code> 各层 以及各种数据库、连接池、三方依赖组件、配置加载
全部都使用以上模式的代码</p> <p>当然，设计没有好坏只有适合和不适合。但这种代码组织模式，更适合在代码量较小的项目里，快速验证业务。</p> <h3 id="非显式依赖全局实体或函数"><a href="#非显式依赖全局实体或函数" class="header-anchor">#</a> 非显式依赖全局实体或函数</h3> <p>非显式依赖体现于：一个模块对另一个模块的依赖，只会在代码逻辑块中通过全局变量或函数引用体现。</p> <p>而在项目结构、模块稍微复杂点的项目，一旦开发人员增多，这些隐式初始化的全局变量，以及通过全局函数调用的隐含依赖关系，就会变成导致代码质量急剧下降的破窗。</p> <p>主要的影响会体现在以下几点：</p> <ol><li>隐含依赖关系的不确定性，会更容易导致循环依赖</li> <li>没有清晰的接口和分层依赖关系，导致业务和代码可读性差，新人学习成本大</li> <li>模块非接口化暴露，对模块功能没有具象化描述，模块间界限也极其模糊和脆弱</li> <li>组件可全局引用，导致其他水平欠缺的开发人员容易不规范调用及混淆层级</li> <li>全局变量引用的组件实例在进行功能测试时更难进行 Mock 或 埋点替换</li> <li>对项目的技术性优化和建设，也会因为这些不确定的对象引用导致难以进行</li></ol> <p>除此之外，组件和配置的不确定性和非显式前置初始化，也会对开发调试和生产运维带来更多隐患。</p> <p>这些负面影响，导致项目质量随着功能需求、开发人员的迭代不断地下滑，严重影响项目开发的推进和增加变更不确定性，同时也影响了开发团队的积极性。</p> <h3 id="显式依赖接口-依赖注入"><a href="#显式依赖接口-依赖注入" class="header-anchor">#</a> 显式依赖接口 + 依赖注入</h3> <p>当时，笔者落地的第一个优化，就是将模块服务进行实体聚合，并抽象为接口，最终通过显式接口依赖组装服务实体，并调研依赖注入工具来维护这些实体的组装</p> <p>如</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 应用入口</span>
<span class="token keyword">package</span> main

<span class="token keyword">var</span> Engine <span class="token operator">*</span>gin<span class="token punctuation">.</span>Engine

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	Engine<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">,</span> api<span class="token punctuation">.</span>GetUser<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// API路由层</span>
<span class="token keyword">package</span> api

<span class="token keyword">func</span> <span class="token function">GetUser</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 初始化参数</span>
	<span class="token keyword">var</span> param svcuser<span class="token punctuation">.</span>QueryUser

	<span class="token comment">// 绑定校验参数</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBind</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		pkg<span class="token punctuation">.</span><span class="token function">Response</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 调起服务</span>
	ret<span class="token punctuation">,</span> err <span class="token operator">:=</span> svcuser<span class="token punctuation">.</span><span class="token function">GetUser</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		pkg<span class="token punctuation">.</span><span class="token function">Response</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 返回值</span>
	pkg<span class="token punctuation">.</span><span class="token function">Response</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> ret<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 服务层</span>
<span class="token keyword">package</span> svcuser

<span class="token keyword">func</span> <span class="token function">GetUser</span><span class="token punctuation">(</span>query QueryUser<span class="token punctuation">)</span> <span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>

</code></pre></div><p>重构为</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 应用入口</span>
<span class="token keyword">package</span> main

<span class="token keyword">type</span> Application <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token operator">*</span>gin<span class="token punctuation">.</span>Engine
<span class="token punctuation">}</span>

<span class="token comment">// 组装接口 </span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>app Application<span class="token punctuation">)</span> <span class="token function">RegisterUserController</span><span class="token punctuation">(</span>ctl UserController<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	ctl<span class="token punctuation">.</span><span class="token function">RegisterRouter</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Engine<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 领域模型定义层</span>
<span class="token keyword">package</span> service

<span class="token comment">// 定义各层接口和上下文类型</span>
<span class="token keyword">type</span> <span class="token punctuation">(</span>
	UserService <span class="token keyword">interface</span> <span class="token punctuation">{</span>
		<span class="token function">GetUser</span><span class="token punctuation">(</span>QueryUser<span class="token punctuation">)</span> <span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	UserController <span class="token keyword">interface</span> <span class="token punctuation">{</span>
		<span class="token function">RegisterRouter</span><span class="token punctuation">(</span>router gin<span class="token punctuation">.</span>IRouter<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	Controller <span class="token keyword">interface</span> <span class="token punctuation">{</span>
		<span class="token function">Response</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> data <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">,</span> status <span class="token builtin">int</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// API层</span>
<span class="token keyword">package</span> api

<span class="token comment">// 实现接口</span>
<span class="token keyword">type</span> UserControllerImpl <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	service<span class="token punctuation">.</span>Controller
	service<span class="token punctuation">.</span>UserService
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>impl <span class="token operator">*</span>UserControllerImpl<span class="token punctuation">)</span> <span class="token function">RegisterRouter</span><span class="token punctuation">(</span>router gin<span class="token punctuation">.</span>IRouter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	router<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">,</span> impl<span class="token punctuation">.</span>GetUser<span class="token punctuation">)</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>impl <span class="token operator">*</span>UserControllerImpl<span class="token punctuation">)</span> <span class="token function">GetUser</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 初始化参数</span>
	<span class="token keyword">var</span> param service<span class="token punctuation">.</span>QueryUser

	<span class="token comment">// 绑定校验参数</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBind</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		impl<span class="token punctuation">.</span><span class="token function">Response</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 调起服务</span>
	ret<span class="token punctuation">,</span> err <span class="token operator">:=</span> impl<span class="token punctuation">.</span>UserService<span class="token punctuation">.</span><span class="token function">GetUser</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		impl<span class="token punctuation">.</span><span class="token function">Response</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 返回值</span>
	impl<span class="token punctuation">.</span><span class="token function">Response</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> ret<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 服务实现</span>
<span class="token keyword">package</span> svcimpls

<span class="token comment">// 实现 service.UserService</span>
<span class="token keyword">type</span> UserServiceImpl <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token comment">// 下层依赖</span>
	db<span class="token punctuation">.</span>SqlConn
	dao<span class="token punctuation">.</span>UserDao
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>impl <span class="token operator">*</span>UserControllerImpl<span class="token punctuation">)</span> <span class="token function">GetUser</span><span class="token punctuation">(</span>query service<span class="token punctuation">.</span>QueryUser<span class="token punctuation">)</span> <span class="token punctuation">(</span>service<span class="token punctuation">.</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>

</code></pre></div><p>这种变更可以概括为：</p> <p>通过独立 <code>Interface</code> 及 上下文实体类型定义，描述并约束每个模块的职责范围，同时约束不同层级交互所使用的上下文实体，
<code>Implement</code> 通过显式依赖下层接口，最终呈现树状化依赖图。</p> <h5 id="这种代码架构组织的模式实例可以参考另一个优秀的项目-drone"><a href="#这种代码架构组织的模式实例可以参考另一个优秀的项目-drone" class="header-anchor">#</a> <em>这种代码架构组织的模式实例可以参考另一个优秀的项目 <a href="https://github.com/harness/gitness/tree/drone" target="_blank" rel="noopener noreferrer">drone<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></em></h5> <h3 id="接口设计和依赖注入工具化"><a href="#接口设计和依赖注入工具化" class="header-anchor">#</a> 接口设计和依赖注入工具化</h3> <p>通过这种组织模式让开发在设计代码前能够主动地去思考每个模块提供的服务和依赖，形成标准化服务意识，项目负责人也能够提前对各层接口进行Review，提前发现隐患和优化规范。</p> <p>然而，引入新的规范，也会增加开发人员的学习成本和维护负担，如果不提供系统性的工具去统一规范，
在人员素质参差的团队中，一旦出现误用的破窗，随着迭代的累积，也只是会成为又一个遗留技术债务。</p> <p>为了快速落地和推广基于 显式接口依赖 和 依赖注入 的模式，笔者为团队提供了两个小工具：</p> <ol><li><p>快速生成 <code>Interface</code> 实现模版到指定目录</p></li> <li><p>通过注解自动化收集被注解元素，生成 <code>wire</code>
集合和实例化入口文件 ( 后开源为 <a href="https://github.com/Just-maple/go-autowire" target="_blank" rel="noopener noreferrer">go-autowire<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> )</p></li></ol> <p>这两个工具最初只是各自独立的小脚本，设计实现上只使用了粗浅地正则和模版，没有进行优化和整合，
但已对当前的项目重构以及后续的迭代规范起到了非常关键的作用，解放了团队维护项目架构和后续开发的心智负担。</p> <h3 id="切面化-api-controller"><a href="#切面化-api-controller" class="header-anchor">#</a> 切面化 API Controller</h3> <p>随着代码架构设计规范落地，技术团队也迎来了快速迭代的周期，当时面临的另一个问题就是：API层的代码规范。</p> <p>尽管我们提供了很多的工具类或函数去让开发们用更少的代码去完成API层的代码开发，但是依然会有各种各样的误用或者疏忽产生。</p> <p>包括 <code>Context</code>传递，错误处理，参数绑定，参数验证，返回格式等等。</p> <p>如下有一个很常见的 基于 <code>gin</code> 的 Controller 逻辑：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> api

<span class="token keyword">func</span> <span class="token punctuation">(</span>i Controller<span class="token punctuation">)</span> <span class="token function">GetUser</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 实例化参数</span>
	<span class="token keyword">var</span> query QueryUser
	<span class="token comment">// 绑定参数</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> i<span class="token punctuation">.</span><span class="token function">ShouldBind</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token operator">&amp;</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token comment">// 参数错误处理</span>
		i<span class="token punctuation">.</span><span class="token function">Response</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 调起服务</span>
	ret<span class="token punctuation">,</span> err <span class="token operator">:=</span> i<span class="token punctuation">.</span>UserService<span class="token punctuation">.</span><span class="token function">GetUser</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token comment">// 服务错误处理</span>
		i<span class="token punctuation">.</span><span class="token function">Response</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 返回值</span>
	i<span class="token punctuation">.</span><span class="token function">Response</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> ret<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>但很多技术团队在使用时经常也会因为很多细微的写法出现预料之外的情况</p> <p>如将</p> <div class="language-go extra-class"><pre class="language-go"><code>i<span class="token punctuation">.</span><span class="token function">ShouldBind</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token operator">&amp;</span>query<span class="token punctuation">)</span>
</code></pre></div><p>写成了</p> <div class="language-go extra-class"><pre class="language-go"><code>i<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token operator">&amp;</span>query<span class="token punctuation">)</span>
</code></pre></div><p>再比如</p> <div class="language-go extra-class"><pre class="language-go"><code>ret<span class="token punctuation">,</span> err <span class="token operator">:=</span> i<span class="token punctuation">.</span>UserService<span class="token punctuation">.</span><span class="token function">GetUser</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query<span class="token punctuation">)</span>
</code></pre></div><p>写成了</p> <div class="language-go extra-class"><pre class="language-go"><code>ret<span class="token punctuation">,</span> err <span class="token operator">:=</span> i<span class="token punctuation">.</span>UserService<span class="token punctuation">.</span><span class="token function">GetUser</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> query<span class="token punctuation">)</span>
</code></pre></div><p>再比如有的团队为了代码美观，也会使用以下的写法</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> api

<span class="token keyword">func</span> <span class="token punctuation">(</span>i Controller<span class="token punctuation">)</span> <span class="token function">GetUser</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> query QueryUser
	<span class="token keyword">var</span> err <span class="token builtin">error</span>
	<span class="token keyword">var</span> ret <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> i<span class="token punctuation">.</span><span class="token function">Response</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> ret<span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> err <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">ShouldBind</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token operator">&amp;</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	ret<span class="token punctuation">,</span> err <span class="token operator">=</span> i<span class="token punctuation">.</span>UserService<span class="token punctuation">.</span><span class="token function">GetUser</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这几个错误案例的存在的问题都是比较隐秘难以排查，但事故后果都可能是非常严重的，但是它们却非常地常见于各个企业内的技术团队。</p> <p>这些隐患本质也不是 <code>gin</code> 的问题，无论你的技术团队用的是什么Web框架。只要开发过程中每个开发者都有可能会接触到
<code>API Controller</code> 层的代码，且有人对框架不熟悉，你的团队都会面临类似的问题。</p> <hr> <p>为了减轻开发和评审负担，省去额外维护的成本，笔者为当时团队提供了一个适配器，
用以转接所有 <code>API Controller</code> 到 <code>Service</code> 层的调用。</p> <p>开发者在进行 <code>API Controller</code> 和 <code>Service</code> 绑定时，只需要</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> api

<span class="token keyword">type</span> HandlerWrapper <span class="token keyword">func</span><span class="token punctuation">(</span>fn <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>impl <span class="token operator">*</span>UserControllerImpl<span class="token punctuation">)</span> <span class="token function">RegisterRouter</span><span class="token punctuation">(</span>wrap HandlerWrapper<span class="token punctuation">,</span> router gin<span class="token punctuation">.</span>IRouter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	router<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">,</span> <span class="token function">wrap</span><span class="token punctuation">(</span>impl<span class="token punctuation">.</span>UserService<span class="token punctuation">.</span>GetUser<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>HandlerWrapper</code> 可以接受任意的 函数 作为参数，并转化为一个可以提供给 Web框架 进行API路由注册的 <code>Handler</code>。</p> <p>而这里最核心的 <code>HandlerWrapper</code> 则 只由对框架比较熟悉的人进行设计，其他开发日常过程中几乎不会接触到 <code>API Controller</code> 的细节。</p> <p>要实例化一个转接适配器，需要确定两个事情：</p> <ol><li>Web框架 的上下文，将会被怎样绑定到给到的参数上</li> <li>Web框架 处理要怎么处理 服务处理的返回值 以及 可能返回的错误</li></ol> <p>因此 只需要提供一个 <code>Controller</code> 类型， 我们就可以通过 <code>reflect</code> 去主动感知 <code>Service</code> 的方法参数类型，以及借助 <code>Interface</code>
特性，去自动化地提供一个项目专用 <code>API Controller</code>。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> api

<span class="token keyword">type</span> Controller <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token comment">// 处理参数绑定逻辑</span>
	<span class="token function">Params</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> params <span class="token operator">...</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token comment">// 处理错误或返回值逻辑</span>
	<span class="token function">Response</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> data <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> HandlerWrapper <span class="token keyword">func</span><span class="token punctuation">(</span>fn <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">InitController</span><span class="token punctuation">(</span>controller Controller<span class="token punctuation">)</span> HandlerWrapper <span class="token punctuation">{</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在<a href="https://github.com/Just-maple/svc2handler" target="_blank" rel="noopener noreferrer">最初的实现中<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,
使用 <code>reflect</code> 去做 <code>service.Interface.Method</code> 的参数分配 和  <code>service.Interface.Method</code> 的调用，
因此会有一定的性能损耗。</p> <p>但通过这种方式实现的 <code>API Controller</code> 的接口参数和返回值，
将会具备非常明显的 <a href="https://en.wikipedia.org/wiki/Duck_typing" target="_blank" rel="noopener noreferrer">DuckTyping<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 特质，
也很容易对某些需求进行统一化处理，生产实践中对于同业务线下的项目，也希望API参数和返回值风格都得到统一，
因此这种特质也是大部分业务场景需要的。</p> <p>因此我们在平衡性能和开发效率以及可长期迭代性之后，因 <code>reflect</code> 带来的一点损耗 其实也相对微不足道。</p> <p>同时，对于如下形式的API层路由绑定代码</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> api

<span class="token keyword">func</span> <span class="token punctuation">(</span>impl <span class="token operator">*</span>UserControllerImpl<span class="token punctuation">)</span> <span class="token function">RegisterRouter</span><span class="token punctuation">(</span>wrap HandlerWrapper<span class="token punctuation">,</span> router gin<span class="token punctuation">.</span>IRouter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	router<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">,</span> <span class="token function">wrap</span><span class="token punctuation">(</span>impl<span class="token punctuation">.</span>UserService<span class="token punctuation">.</span>GetUser<span class="token punctuation">)</span><span class="token punctuation">)</span>
	router<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">,</span> <span class="token function">wrap</span><span class="token punctuation">(</span>impl<span class="token punctuation">.</span>UserService<span class="token punctuation">.</span>NewUser<span class="token punctuation">)</span><span class="token punctuation">)</span>
	router<span class="token punctuation">.</span><span class="token function">DELETE</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">,</span> <span class="token function">wrap</span><span class="token punctuation">(</span>impl<span class="token punctuation">.</span>UserService<span class="token punctuation">.</span>DeleteUser<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>

</code></pre></div><p>可见，已经明显是十分模板化的代码，因此笔者也给团队提供了对应的<a href="https://github.com/Just-maple/annotation-service" target="_blank" rel="noopener noreferrer">代码生成工具<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，
可以使用 <code>Service</code> 层的接口定义，进行自动化API路由服务表生成。</p> <p>如以下例子，可以生成上述API层路由绑定代码</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> api

<span class="token keyword">type</span> <span class="token punctuation">(</span>
	<span class="token comment">// @service(user)</span>
	UserService <span class="token keyword">interface</span> <span class="token punctuation">{</span>
		<span class="token comment">// @http(method=get,route=&quot;&quot;)</span>
		<span class="token function">GetUser</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> query QueryUser<span class="token punctuation">)</span> <span class="token punctuation">(</span>u User<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span>
		<span class="token comment">// @http(method=post,route=&quot;&quot;)</span>
		<span class="token function">NewUser</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> form FormUser<span class="token punctuation">)</span> <span class="token punctuation">(</span>u User<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span>
		<span class="token comment">// @http(method=delete,route=&quot;&quot;)</span>
		<span class="token function">DeleteUser</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> query QueryUser<span class="token punctuation">)</span> <span class="token punctuation">(</span>u User<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">)</span>

</code></pre></div><h5 id="此时的注解语法风格借鉴了-java-spring。"><a href="#此时的注解语法风格借鉴了-java-spring。" class="header-anchor">#</a> 此时的注解语法风格借鉴了 <code>JAVA Spring</code>。</h5> <p>这些工具和模式的落地效果，也在后续一些新立项的C端营销系统中得到了全面的验证，使用该模式进行的团队协作API开发效率远超以往的方式，
同时在项目架构设计以及代码质量上，也可以看到非常明显的人效提升。
除此之外，团队开发们在搭建一个新的服务或者接手其他的项目时，已经不需要额外花费架构和API风格上的理解或构思成本。</p> <h2 id="它是如何工作的"><a href="#它是如何工作的" class="header-anchor">#</a> 它是如何工作的？</h2></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/go-zing/gozz-doc/edit/master/docs/zh/guide/README.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/10/15 10:31:48</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/gozz/assets/js/app.182b309c.js" defer></script><script src="/gozz/assets/js/2.56b32e98.js" defer></script><script src="/gozz/assets/js/1.43cfabac.js" defer></script><script src="/gozz/assets/js/24.eaeafa36.js" defer></script>
  </body>
</html>
